{"remainingRequest":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\src\\components\\shop\\ShopList.vue?vue&type=style&index=0&id=3fa9896d&lang=less&scoped=true","dependencies":[{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\src\\components\\shop\\ShopList.vue","mtime":1689412214000},{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\css-loader\\index.js","mtime":1709293572000},{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1709293572000},{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\less-loader\\dist\\cjs.js","mtime":1709293572000},{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1709293572000},{"path":"C:\\Users\\22075\\Desktop\\MiniProgram\\微信小程序-心理资讯\\psychology_admin_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1709293572000}],"contextDependencies":[],"result":["\r\n.tabinfo {\r\n    display: flex;\r\n\r\n    .imgbox {\r\n        width: 60px;\r\n        padding: 10px;\r\n        padding-left: 0;\r\n        position: relative;\r\n\r\n        .status_ts {\r\n            position: absolute;\r\n            width: 60px;\r\n            height: 60px;\r\n            padding-top: 18px;\r\n            top: 10px;\r\n            left: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            text-align: center;\r\n            color: #fff;\r\n            display: inline-block;\r\n            z-index: 1000;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .commodity-img,\r\n        .defaultimg {\r\n            cursor: pointer;\r\n            border-radius: 4px;\r\n            transition: all 0.2s;\r\n            border: 1px solid #f1f1f1;\r\n            width: 60px;\r\n            height: 60px;\r\n        }\r\n\r\n        .defaultimg {\r\n            background: #e9e9e9;\r\n            display: inline-block;\r\n            text-align: center;\r\n            padding-top: 15px;\r\n        }\r\n\r\n        // .commodity-img:hover {\r\n        //     z-index: 1000;\r\n        //     margin-left: 142px;\r\n        //     transform: scale(6);\r\n        //     position: relative;\r\n        //     z-index: 1001;\r\n        // }\r\n    }\r\n\r\n    .textbox {\r\n        margin: 10px 0 0 10px;\r\n    }\r\n}\r\n",{"version":3,"sources":["ShopList.vue"],"names":[],"mappings":";AA4UA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"ShopList.vue","sourceRoot":"src/components/shop","sourcesContent":["<template>\r\n    <div class=\"list\">\r\n        <!-- 面包屑导航区域 -->\r\n        <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n            <el-breadcrumb-item :to=\"{ path: '/home' }\">首页</el-breadcrumb-item>\r\n            <el-breadcrumb-item>服务管理</el-breadcrumb-item>\r\n            <el-breadcrumb-item>文章管理</el-breadcrumb-item>\r\n        </el-breadcrumb>\r\n\r\n        <!-- 卡片视图区域 -->\r\n        <el-card>\r\n            <!-- 搜索与添加区域 -->\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"8\">\r\n                    <el-input placeholder=\"请输入文章标题\" v-model=\"searchQuery\" clearable @clear=\"getTableList()\">\r\n                        <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"getShopnameList\"></el-button>\r\n                    </el-input>\r\n                </el-col>\r\n                <el-col :span=\"4\">\r\n                    <el-button type=\"primary\" @click=\"setShopModal(true,null)\">新增文章</el-button>\r\n                </el-col>\r\n            </el-row>\r\n\r\n            <!-- 文章列表区域 -->\r\n            <el-table :data=\"tableList\" border stripe>\r\n                <el-table-column label=\"序号\" type=\"index\"></el-table-column>\r\n                <el-table-column label=\"创建用户\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-select style=\"width:60%;\" v-model=\"scope.row.usershop_id\" disabled>\r\n                            <el-option v-for=\"(item, index) in shopList\" :key=\"index\" :label=\"item.username\" :value=\"item.id\"></el-option>\r\n                        </el-select>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"文章分类\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-select style=\"width:60%;\" v-model=\"scope.row.class_id\" disabled>\r\n                            <el-option v-for=\"(item, index) in classList\" :key=\"index\" :label=\"item.class_name\" :value=\"item.id\"></el-option>\r\n                        </el-select>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"文章信息\">\r\n                    <template slot-scope=\"scope\">\r\n                        <div class=\"tabinfo\">\r\n                            <div class=\"imgbox\">\r\n                                <img class=\"commodity-img\" :src=\"scope.row.item_image\">\r\n                            </div>\r\n                            <div class=\"textbox\">\r\n                                <div>文章标题：{{scope.row.item_name}}</div>\r\n                            </div>\r\n                        </div>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"是否推荐\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag :type=\"scope.row.is_recommend ? 'success' : 'info'\">\r\n                            {{scope.row.is_recommend ? '是' : '否'}}\r\n                        </el-tag>\r\n                    </template>\r\n                </el-table-column>\r\n                <!-- <el-table-column label=\"内容\">\r\n                    <template slot-scope=\"scope\">\r\n                        <div v-html=\"scope.row.item_practice\"></div>\r\n                    </template>\r\n                </el-table-column> -->\r\n                <el-table-column label=\"操作\" width=\"150px\">\r\n                    <template slot-scope=\"scope\">\r\n                        <!-- 修改按钮 -->\r\n                        <el-button type=\"primary\" icon=\"el-icon-edit\" size=\"mini\" @click=\"setShopModal(false,scope.row)\"></el-button>\r\n                        <!-- 删除按钮 -->\r\n                        <el-button type=\"danger\" icon=\"el-icon-delete\" size=\"mini\" @click=\"removeShopById(scope.row.id)\"></el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </el-card>\r\n\r\n        <!-- 新增 & 修改文章内容区域 -->\r\n        <el-dialog title=\"新增文章\" :visible.sync=\"isModal\" width=\"66%\" @close=\"editDialogClosed\">\r\n            <el-form :model=\"formSource\" ref=\"formSourceRef\" label-width=\"90px\">\r\n                <el-form-item label=\"创建用户\" label-width=\"160px\" required>\r\n                    <el-select style=\"width:100%;\" v-model=\"formSource.usershop_id\" placeholder=\"请选择创建用户\">\r\n                        <el-option v-for=\"(item, index) in shopList\" :key=\"index\" :label=\"item.username\" :value=\"item.id\"></el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"文章分类\" label-width=\"160px\" required>\r\n                    <el-select style=\"width:100%;\" v-model=\"formSource.class_id\" placeholder=\"请选择文章分类\">\r\n                        <el-option v-for=\"(item, index) in classList\" :key=\"index\" :label=\"item.class_name\" :value=\"item.id\"></el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"文章标题\" label-width=\"160px\" required>\r\n                    <el-input maxlength=\"36\" v-model=\"formSource.item_name\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"文章图片\" label-width=\"160px\" required>\r\n                    <!-- <el-upload action=\"http://localhost:6008/uploadImg\" :http-request=\"upload\" list-type=\"picture-card\" :auto-upload=\"false\" :file-list=\"fileList\" :limit=\"3\" :on-change=\"imageChange\" :on-exceed=\"exceedChange\"> -->\r\n                    <el-upload action=\"http://localhost:6008/uploadImg\" :http-request=\"upload\" list-type=\"picture-card\" :file-list=\"fileList\" :limit=\"1\" :on-change=\"imageChange\" :on-exceed=\"exceedChange\">\r\n                        <i slot=\"default\" class=\"el-icon-plus\"></i>\r\n                        <div slot=\"file\" slot-scope=\"{file}\">\r\n                            <img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\">\r\n                            <span class=\"el-upload-list__item-actions\">\r\n                                <span class=\"el-upload-list__item-preview\" @click=\"handlePictureCardPreview(file)\">\r\n                                    <i class=\"el-icon-zoom-in\"></i>\r\n                                </span>\r\n                                <span v-if=\"fileList && fileList.length !== 0\" class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n                                    <i class=\"el-icon-delete\"></i>\r\n                                </span>\r\n                            </span>\r\n                        </div>\r\n                    </el-upload>\r\n                </el-form-item>\r\n                <el-form-item label=\"是否推荐\" label-width=\"160px\" required>\r\n                    <el-select style=\"width:100%;\" v-model=\"formSource.is_recommend\" placeholder=\"请选择是否是付费推荐\">\r\n                        <el-option label=\"不推荐\" :value=\"0\"></el-option>\r\n                        <el-option label=\"推荐\" :value=\"1\"></el-option>\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"内容\" label-width=\"160px\" required>\r\n                    <!-- <el-input v-model=\"formSource.item_practice\"></el-input> -->\r\n                    <vueQuillEditor @child-by-value=\"childByValue\" :msg-object=\"formSource.item_practice\"></vueQuillEditor>\r\n                </el-form-item>\r\n            </el-form>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button type=\"primary\" @click=\"saveData\">确 定</el-button>\r\n            </span>\r\n        </el-dialog>\r\n\r\n        <!-- 放大图片 -->\r\n        <el-dialog :visible.sync=\"dialogVisible\">\r\n            <img width=\"100%\" :src=\"viewImage\" alt=\"\">\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\nimport vueQuillEditor from '../shareModule/vueQuillEditor.vue'\r\nexport default {\r\n    components: {\r\n        vueQuillEditor: vueQuillEditor,\r\n    },\r\n    data() {\r\n        return {\r\n            isAdd: false, // 弹框是否新增 默认否\r\n            tableList: [], // 表格数据源\r\n            shopList: [], // 商户数据源\r\n            classList: [], // 分类数据源\r\n            searchQuery: '', // 搜索\r\n            isModal: false, // 控制对话框的显示与隐藏\r\n            formSource: {\r\n                usershop_id: '', // 创建用户\r\n                class_id: '', // 文章分类\r\n                item_name: '', // 文章标题\r\n                item_image: '', // 文章图片\r\n                item_practice: '', // 内容\r\n                is_recommend: 0, // 当前文章是否被当前用户推荐 1推荐 0未推荐\r\n                update_time: this.$moment(new Date()).format('YYYY/MM/DD HH:mm:ss'),\r\n            }, // 表单数据\r\n\r\n            dialogVisible: false,\r\n            fileList: [], // 上传的图片数组\r\n            viewImage: '', // 用于放大查看图片\r\n        }\r\n    },\r\n    created() {\r\n        this.getTableList() // 获取文章\r\n        this.getUserList() // 获取商户\r\n        this.getClassList() // 获取分类\r\n    },\r\n    methods: {\r\n        // 上传图片\r\n        async upload(f) {\r\n            var formData = new FormData()\r\n            formData.append('tweetPic', f.file, f.file.name)\r\n            const { data: res } = await this.$http.post('uploadImg', formData)\r\n            console.log(res, '======图片')\r\n            if (res.status === 200) {\r\n                this.formSource.item_image = res.data.localIamgeAddress\r\n            } else {\r\n                this.$message.error(res.msg)\r\n            }\r\n        },\r\n        // 根据文章名称查询文章\r\n        async getShopnameList() {\r\n            const { data: res } = await this.$http.post('getAllClassContent', { title: this.searchQuery })\r\n            if (res.status === 200) {\r\n                this.tableList = res.data\r\n            } else {\r\n                this.$message.error(res.msg)\r\n            }\r\n        },\r\n        // 获取所有分类下的文章\r\n        async getTableList() {\r\n            const { data: res } = await this.$http.post('getAllClassContent', {})\r\n            if (res.status === 200) {\r\n                this.tableList = res.data\r\n            } else {\r\n                this.$message.error(res.msg)\r\n            }\r\n        },\r\n        // 打开文章信息的弹框\r\n        setShopModal(isAdd, data) {\r\n            this.isModal = true\r\n            this.isAdd = isAdd\r\n            if (!isAdd && data) {\r\n                this.formSource = JSON.parse(JSON.stringify(data));\r\n                this.fileList = [{ url: data.item_image }]\r\n            }\r\n        },\r\n        // 新增 & 修改文章\r\n        async saveData() {\r\n            // 未通过检测 则不在继续执行\r\n            if (!this.checkForm(this.formSource)) {\r\n                return false\r\n            }\r\n            // 已通过检测 则可以发起网络请求\r\n            if (this.isAdd) {\r\n                // 新增\r\n                const { data: res } = await this.$http.post('addAllClassContent', this.formSource)\r\n                if (res.status === 200) {\r\n                    this.isModal = false\r\n                    this.getTableList()\r\n                } else {\r\n                    this.$message.error(res.msg)\r\n                }\r\n            } else {\r\n                // 修改\r\n                // let\r\n                const { data: res } = await this.$http.post('editAllClassContent', this.formSource)\r\n                if (res.status === 200) {\r\n                    this.isModal = false\r\n                    this.getTableList()\r\n                } else {\r\n                    this.$message.error(res.msg)\r\n                }\r\n            }\r\n        },\r\n        // 检查form表单是否全部填写了\r\n        checkForm(data) {\r\n            if (!data.usershop_id) {\r\n                this.$message.error('请选择创建用户')\r\n                return false\r\n            }\r\n            if (!data.class_id) {\r\n                this.$message.error('请选择文章分类')\r\n                return false\r\n            }\r\n            if (!data.item_name) {\r\n                this.$message.error('请输入文章标题')\r\n                return false\r\n            }\r\n            if (!data.item_image) {\r\n                this.$message.error('请上传文章图片')\r\n                return false\r\n            }\r\n            if (!data.item_practice) {\r\n                this.$message.error('请输入内容')\r\n                return false\r\n            }\r\n\r\n            return true\r\n        },\r\n        // 根据id删除文章\r\n        async removeShopById(id) {\r\n            this.$confirm('此操作将无法恢复, 是否继续?', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning',\r\n            })\r\n                .then(async () => {\r\n                    const { data: res } = await this.$http.post('delAllClassContent', { id: id })\r\n                    if (res.status === 200) {\r\n                        this.getTableList()\r\n                    } else {\r\n                        this.$message.error(res.msg)\r\n                    }\r\n                })\r\n                .catch(() => {})\r\n        },\r\n        imageChange(res, file) {\r\n            // this.formSource.item_image = res.url\r\n            console.log(res, file, '=====上传图片的信息')\r\n            this.fileList = file // 图片信息发生变化时 赋值给图\r\n        },\r\n        handleRemove(file) {\r\n            this.fileList = this.fileList.filter((item) => file.uid !== item.uid) // 保留除当前点击图片外的所有图片\r\n        },\r\n        // 放大图片\r\n        handlePictureCardPreview(file) {\r\n            this.viewImage = file.url\r\n            this.dialogVisible = true\r\n        },\r\n        // 由于限制了上传图片的个数 此时提示用户\r\n        exceedChange() {\r\n            this.$message.error('文章图片仅支持上传一张')\r\n        },\r\n\r\n        // 接收子组件 富文本编辑器传递过来的参数\r\n        childByValue(val) {\r\n            console.log(val, '接收的数据')\r\n            this.formSource.item_practice = val\r\n        },\r\n        // 获取商户\r\n        async getUserList() {\r\n            const { data: res } = await this.$http.post('getUser', {})\r\n            if (res.status === 200) {\r\n                this.shopList = res.data\r\n            } else {\r\n                this.$message.error(res.msg)\r\n            }\r\n        },\r\n        // 获取分类\r\n        async getClassList() {\r\n            const { data: res } = await this.$http.post('getClassTabs', {})\r\n            if (res.status === 200) {\r\n                this.classList = res.data\r\n            } else {\r\n                this.$message.error(res.msg)\r\n            }\r\n        },\r\n\r\n        // 关闭修改对话框\r\n        editDialogClosed() {\r\n            this.formSource = {\r\n                usershop_id: '', // 创建用户\r\n                class_id: '', // 文章分类\r\n                item_name: '', // 文章标题\r\n                item_image: '', // 文章图片\r\n                item_practice: '', // 内容\r\n                is_recommend: 0, // 当前文章是否被当前用户推荐 1推荐 0未推荐\r\n            }\r\n            this.fileList = []\r\n        },\r\n    },\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.tabinfo {\r\n    display: flex;\r\n\r\n    .imgbox {\r\n        width: 60px;\r\n        padding: 10px;\r\n        padding-left: 0;\r\n        position: relative;\r\n\r\n        .status_ts {\r\n            position: absolute;\r\n            width: 60px;\r\n            height: 60px;\r\n            padding-top: 18px;\r\n            top: 10px;\r\n            left: 0;\r\n            background: rgba(0, 0, 0, 0.5);\r\n            text-align: center;\r\n            color: #fff;\r\n            display: inline-block;\r\n            z-index: 1000;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .commodity-img,\r\n        .defaultimg {\r\n            cursor: pointer;\r\n            border-radius: 4px;\r\n            transition: all 0.2s;\r\n            border: 1px solid #f1f1f1;\r\n            width: 60px;\r\n            height: 60px;\r\n        }\r\n\r\n        .defaultimg {\r\n            background: #e9e9e9;\r\n            display: inline-block;\r\n            text-align: center;\r\n            padding-top: 15px;\r\n        }\r\n\r\n        // .commodity-img:hover {\r\n        //     z-index: 1000;\r\n        //     margin-left: 142px;\r\n        //     transform: scale(6);\r\n        //     position: relative;\r\n        //     z-index: 1001;\r\n        // }\r\n    }\r\n\r\n    .textbox {\r\n        margin: 10px 0 0 10px;\r\n    }\r\n}\r\n</style>"]}]}